<!DOCTYPE html>
<html lang="en">

<head>
    <title>Authentification callback processing..</title>
</head>

<body>
    <noscript>
        You need to enable JavaScript to run this app.
    </noscript>

    <h1>Authentification callback processing...</h1>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/oidc-client/1.8.2/oidc-client.js"></script>
    <script>
        const codeVerifier = localStorage.getItem("verifier");

        const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");
    const state = urlParams.get("state");

    
    const details = {
    code_verifier: codeVerifier,
    code,
    client_id: process.env.REACT_APP_CLIENTID,
    redirect_uri: `${process.env.REACT_APP_CLIENTROOT}/signin-callback.html`,
    grant_type: "authorization_code",
  };
    const body = Object.keys(details)
    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent((details)[key])}`)
    .join("&");

    fetch(`${process.env.REACT_APP_STSAUTHORITY}/token`, {
    method: "POST",
    body,
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
      "Accept-Encoding": "gzip,deflate",
    },
  }).then((response) => {
      console.log(response);
  }).catch((reason) => {
      console.log("fail ", reason)
  })

    </script>

</body>

</html>